# CRM¬†Telegram‚Äë–±–æ—Ç –Ω–∞ –±–∞–∑–µ Supabase

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø—Ä–æ—Å—Ç–æ–π CRM‚Äë–±–æ—Ç –¥–ª—è Telegram. –ë–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç
—Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ (–ª–∏–¥—ã) –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤ –æ–±–ª–∞—á–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
Supabase. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∞–∫–∫–∞—É–Ω—Ç –≤ Telegram, –ø—Ä–æ–µ–∫—Ç
–≤ Supabase –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Python¬†3.9+.

## 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ça

–î–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Bot API Telegram –Ω–µ–æ–±—Ö–æ–¥–∏–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω. –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ
–º–æ–∂–Ω–æ —É –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞¬†‚Äî **BotFather**:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∏–∞–ª–æ–≥ —Å [@BotFather](https://t.me/BotFather) –≤ Telegram.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º: —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏
   username –±—É–¥—É—â–µ–≥–æ –±–æ—Ç–∞. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ BotFather –≤—ã–¥–∞—Å—Ç —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞
   `123456789:AAFd...`, –∫–æ—Ç–æ—Ä–∞—è –∏ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–∫–µ–Ω–æ–º. –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   Telegram –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
   –≤–∞—à–µ–≥–æ –±–æ—Ç–∞, –ø–æ—ç—Ç–æ–º—É —Ö—Ä–∞–Ω–∏—Ç–µ –µ—ë –∫–∞–∫ –ø–∞—Ä–æ–ª—å –∏ **–Ω–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω–æ**
   „Äê222862539556652‚Ä†L121-L129„Äë.

## 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Supabase

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [supabase.com](https://supabase.com) –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
   –ø—Ä–æ–µ–∫—Ç. –î–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è URL –ø—Ä–æ–µ–∫—Ç–∞ –∏ API‚Äë–∫–ª—é—á.
2. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí **Settings ‚Üí API** –∏ –Ω–∞–π–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è
   `Project URL` –∏ `Anon/Public API Key` –∏–ª–∏ `Service¬†Role API Key`.
3. –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª–µ `.env` (—Å–º. –Ω–∏–∂–µ).
4. –í —Ä–∞–∑–¥–µ–ª–µ **SQL Editor** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `schema.sql`¬†‚Äî –æ–Ω
   —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã `users`, `leads` –∏ `messages` (–ø–æ—Å–ª–µ–¥–Ω—è—è ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
   –¢–∞–±–ª–∏—Ü—ã –∏–º–µ—é—Ç –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è Telegram¬†ID, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ª–∏–¥–∞ –∏
   –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Ç–º–µ—Ç–æ–∫. –ó–∞ –æ—Å–Ω–æ–≤—É –≤–∑—è—Ç –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
   `telegram_users` –∏–∑ —à–∞–±–ª–æ–Ω–∞ n8n: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∏–ø `uuid`, –ø–æ–ª–µ
   `date_created` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
   „Äê842125258632519‚Ä†L117-L127„Äë. –í –Ω–∞—à–µ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã —Å–≤—è–∑–∏
   –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ª–∏–¥–∞–º–∏.

### 2.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Row Level Security (RLS)

Supabase –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É RLS. –ß—Ç–æ–±—ã –±–æ—Ç –º–æ–≥
—Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∏, —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ `SELECT` –∏ `INSERT`
–¥–ª—è —Ç–∞–±–ª–∏—Ü `users` –∏ `leads` (–≤ —Ä–∞–∑–¥–µ–ª–µ **Auth ‚Üí Policies**). –°–∞–º—ã–π
–ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è¬†‚Äî —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤—Å–µ–º (`role` = `anon`) –Ω–∞
—á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å
—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
BOT_TOKEN=<—Ç–æ–∫–µ–Ω –æ—Ç BotFather>
SUPABASE_URL=https://<–≤–∞—à_–ø—Ä–æ–µ–∫—Ç>.supabase.co
SUPABASE_KEY=<anon_–∏–ª–∏_service_role_key>
```

`BOT_TOKEN` –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ BotFather. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `SUPABASE_URL` –∏
`SUPABASE_KEY` –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ø–∞–Ω–µ–ª–∏ Supabase (Settings ‚Üí API).

## 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `aiogram` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram –∏ `supabase-py`
–¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Supabase. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `pip`:

```bash
python -m pip install -r requirements.txt
```

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Supabase —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø–∞–∫–µ—Ç
`supabase-py` —á–µ—Ä–µ–∑ `pip install supabase`
„Äê103787523269103‚Ä†L133-L144„Äë. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å URL
–ø—Ä–æ–µ–∫—Ç–∞ –∏ –∫–ª—é—á: `create_client(url, key)`„Äê103787523269103‚Ä†L147-L189„Äë.
`aiogram` –æ–±–ª–µ–≥—á–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å Telegram: –≤—ã —Å–æ–∑–¥–∞—ë—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –∏
–¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ
**long¬†polling**„Äê965784237992181‚Ä†L34-L69„Äë.

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
crm_tg_bot/
‚îú‚îÄ‚îÄ bot.py          # –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ schema.sql      # SQL‚Äë—Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –≤ Supabase
‚îú‚îÄ‚îÄ requirements.txt# –ø–µ—Ä–µ—á–µ–Ω—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ .env.example    # –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md       # —Ç–µ–∫—É—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

### 5.1 –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

* `bot.py` ‚Äî —Ä–µ–∞–ª–∏–∑—É–µ—Ç –±–æ—Ç–∞. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –æ–Ω:
  - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`BOT_TOKEN`, `SUPABASE_URL`, `SUPABASE_KEY`);
  - —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞ Supabase (`create_client()`);
  - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä (`Bot`, `Dispatcher`);
  - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ (`/start`, `/help`, `/newlead`, `/myleads`) –∏
    —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –ª–∏–¥–∞;
  - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—ã `users` –∏ `leads`.
* `schema.sql`¬†‚Äî —Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã:
  - `users` —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö Telegram (ID, username, –∏–º—è,
    —Ñ–∞–º–∏–ª–∏—è, –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è);
  - `leads` —Å–≤—è–∑—ã–≤–∞–µ—Ç –ª–∏–¥–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, e‚Äëmail,
    —Å—Ç–∞—Ç—É—Å –∏ –¥–∞—Ç—É —Å–æ–∑–¥–∞–Ω–∏—è;
  - `messages` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    –≤—Ö–æ–¥—è—â–∏—Ö/–∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

## 6. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Python¬†3.9+ –∏ —Å–æ–∑–¥–∞–Ω –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
   –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   python -m pip install -r requirements.txt
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ, –∫–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ.

4. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase, –≤—ã–ø–æ–ª–Ω–∏–≤ `schema.sql` —á–µ—Ä–µ–∑ SQL Editor.

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

   ```bash
   python bot.py
   ```

6. –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ username, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∑–∞–¥–∞–ª–∏ BotFather,
   –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É –∫–æ–º–∞–Ω–¥—É `/start` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º. –ë–æ—Ç
   –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–∞—Å –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —Å–æ–∑–¥–∞—Ç—å –ª–∏–¥–∞ —á–µ—Ä–µ–∑ `/newlead`.
   –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –ª–∏–¥–∞ –±–æ—Ç –±—É–¥–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –∏–º—è,
   —Ç–µ–ª–µ—Ñ–æ–Ω –∏ e‚Äëmail, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É `leads` –∏ –≤—ã–≤–æ–¥–∏—Ç—å —Å–ø–∏—Å–æ–∫
   –≤–∞—à–∏—Ö –ª–∏–¥–æ–≤ –ø–æ –∫–æ–º–∞–Ω–¥–µ `/myleads`.

## 7. –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

* **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è.** –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Supabase –∏
  —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç `supabase`. –ö–ª–∞—Å—Å `Dispatcher` –∏–∑ `aiogram` –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞
  –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
* **–ö–æ–º–∞–Ω–¥–∞ `/start`.** –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å —Å —Ç–µ–∫—É—â–∏–º
  `telegram_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`. –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë—Ç –µ—ë. –ó–∞—Ç–µ–º –≤—ã–≤–æ–¥–∏—Ç
  –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫—Ä–∞—Ç–∫–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π.
* **–ö–æ–º–∞–Ω–¥–∞ `/newlead`.** –í–∫–ª—é—á–∞–µ—Ç—Å—è FSM (`LeadForm`), –∫–æ—Ç–æ—Ä–∞—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º
  –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ e‚Äëmail. –ö–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
  —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (`FSMContext`). –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞
  –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `leads` –∏ FSM —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
* **–ö–æ–º–∞–Ω–¥–∞ `/myleads`.** –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ `leads`, —Ñ–∏–ª—å—Ç—Ä—É—è
  –ø–æ `telegram_id`. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞.

## 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

* **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.** –°–µ–π—á–∞—Å –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ —Å—Ç—Ä–æ–∫–∏. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å
  –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ
  –≤—ã—Ä–∞–∂–µ–Ω–∏—è.
* **–°—Ç–∞—Ç—É—Å—ã –ª–∏–¥–æ–≤.** –ü–æ–ª–µ `status` –≤ —Ç–∞–±–ª–∏—Ü–µ `leads` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏–¥–∞ (–Ω–æ–≤—ã–π, –≤ —Ä–∞–±–æ—Ç–µ, –∑–∞–∫—Ä—ã—Ç –∏ —Ç.–¥.).
* **–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∏.** –¢–∞–±–ª–∏—Ü–∞ `messages` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
  –≤—Ö–æ–¥—è—â–∏–µ/–∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è (`inbound`/`outbound`).
* **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.** Supabase –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç webhooks –∏
  —Ñ–æ–Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –ª–∏–¥–æ–≤,
  –æ—Ç–ø—Ä–∞–≤–∫—É e‚Äëmail‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–ª–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å CRM‚Äë—Å–∏—Å—Ç–µ–º–∞–º–∏.

## 9. –ò—Å—Ç–æ—á–Ω–∏–∫–∏

* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Supabase –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  `supabase-py`, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `pip install supabase` –∏ –≤—ã–∑–≤–∞—Ç—å
  `create_client(url, key)` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞„Äê103787523269103‚Ä†L133-L189„Äë.
* –®–∞–±–ª–æ–Ω n8n –¥–ª—è Telegram‚Äë–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π UUID —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π„Äê842125258632519‚Ä†L117-L127„Äë.
* –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram —Å–æ–≤–µ—Ç—É–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ BotFather
  —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `/newbot` –∏ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –∫–∞–∫ –ø–∞—Ä–æ–ª—å„Äê222862539556652‚Ä†L121-L129„Äë.
* –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `aiogram` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞,
  –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥, –ø–æ—Å–ª–µ —á–µ–≥–æ –±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
  –≤ —Ä–µ–∂–∏–º–µ long¬†polling„Äê965784237992181‚Ä†L34-L69„Äë.

---

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–º–µ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è
—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π CRM‚Äë—Å–∏—Å—Ç–µ–º—ã –∏ —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –µ–≥–æ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

## –ù–æ–≤–∞—è UI‚Äë–ª–æ–≥–∏–∫–∞ –∏ –∑–∞–¥–∞—á–∏

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–µ–Ω—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –ø—Ä—è–º–æ –∏–∑ Telegram. –í–º–µ—Å—Ç–æ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ–¥
—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –±–æ—Ç–∞. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø—Ü–∏–∏:

- **üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏** ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ë–æ—Ç
  —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—Ä–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å) –∏
  –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É. –í –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ¬´‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É¬ª
  –∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏. –ù–∞–∂–∞–≤ –Ω–∞ –∑–∞–¥–∞—á—É, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Ä–µ–∂–∏–º—É –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
- **‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞** ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏. –ë–æ—Ç
  –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–ª–∏–µ–Ω—Ç–∞, –¥–µ–¥–ª–∞–π–Ω, –æ–ø–∏—Å–∞–Ω–∏–µ –∏
  –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 0, —á—Ç–æ–±—ã –Ω–∞–∑–Ω–∞—á–∏—Ç—å
  –∑–∞–¥–∞—á—É —Å–µ–±–µ). –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑
  –∫–æ–º–∞–Ω–¥—É `/newtask`.

–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏ –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
—Ä–µ–∑—É–ª—å—Ç–∞—Ç. –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏–ª–∏ —Ñ–∞–π–ª–æ–º
(–¥–æ–∫—É–º–µ–Ω—Ç–æ–º –∏–ª–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π). –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ
`result` —Ç–∞–±–ª–∏—Ü—ã `tasks` –∏ —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞
¬´–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏¬ª. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–∞–π–ª, –±–æ—Ç
—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ–∞–π–ª–∞ Telegram –≤ —Ç–∞–±–ª–∏—Ü–µ `task_files`.

–ö–Ω–æ–ø–∫–∞ ¬´‚ùå –û—Ç–º–µ–Ω–∞¬ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏
–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª—é–±–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç –≤—Å–µ–≥–¥–∞
–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫, —É–±–∏—Ä–∞—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã, —á—Ç–æ–±—ã
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ø—É—Ç–∞–ª—Å—è.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –±–æ—Ç —Å—Ç–∞–ª —É–¥–æ–±–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (—Ñ–∞—Å–∞–¥–æ–º) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
–∑–∞–¥–∞—á–∞–º–∏ –≤ CRM: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á, –≤—ã–±–æ—Ä, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ
—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏, –∞ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤
Supabase.